# Story 4.2: Individual Blog Post Template Design

Status: ContextReady

## Story

**As a** reader who has selected a blog article,
**I want** a comfortable reading experience with proper typography and related content suggestions,
**so that** I can easily consume the content and discover more relevant articles.

## Acceptance Criteria

1. Clean, readable typography optimized for Norwegian language with line width of 73 characters
2. Proper heading hierarchy and content structure throughout the post
3. Image support via MDX with proper alt text and captions
4. Author information and publication date display in Norwegian format
5. Related articles section at the bottom of each post (latest 3 articles in same category)
6. Mobile-optimized reading experience with adjustable text size
7. Social sharing functionality for Norwegian social platforms
8. Reading time estimation displayed prominently

## Tasks / Subtasks

- [x] Create individual blog post template structure (AC: 1, 2)
  - [x] Set up basic post layout with proper Norwegian language metadata
  - [x] Implement typography optimized for Norwegian readability (73 char line width)
  - [x] Add proper heading hierarchy (h1, h2, h3) with consistent styling
- [x] Implement MDX content rendering (AC: 3)
  - [x] Create MDX renderer component for blog posts
  - [x] Add image support with proper sizing and alt text handling
  - [x] Implement caption functionality for images
- [x] Add post metadata display (AC: 4)
  - [x] Create author information component with Norwegian formatting
  - [x] Implement publication date display in Norwegian format (DD.MM.YYYY)
  - [x] Add reading time estimation based on content length
- [x] Implement related articles section (AC: 5)
  - [x] Create logic to find related articles by category/tag
  - [x] Design related articles component with Norwegian styling
  - [x] Add proper navigation between related posts
- [x] Optimize for mobile reading (AC: 6)
  - [x] Implement responsive typography that scales properly
  - [x] Add text size adjustment controls for accessibility
  - [x] Ensure proper spacing and readability on mobile devices
- [x] Add social sharing functionality (AC: 7)
  - [x] Implement sharing buttons for Norwegian social platforms
  - [x] Add proper metadata for social sharing (Open Graph)
  - [x] Create shareable links with Norwegian context

## Dev Notes

### Previous Story Insights
From Story 4.1: Blog listing page has been implemented with Norwegian categories (Vedlikehold, Tips, Nyheter, Sesongguide) and uses existing Shadcn card components. The blog content is managed through DecapCMS with MDX files in content/posts/.

### Data Models
Based on existing blog structure in the codebase:
- Blog posts are stored as MDX files in `content/posts/` [Source: source-tree.md#177]
- Each post contains frontmatter with metadata (title, date, tags, author, etc.) [Source: brownfield-architecture.md#99]
- Blog content is managed through DecapCMS [Source: brownfield-architecture.md#91]
- Norwegian category tags are defined in `meta/tags.yml` [Source: source-tree.md#177]

### API Specifications
- No REST APIs - static site generation with content loading from MDX files [Source: brownfield-architecture.md#106]
- Content loading utilities exist in `src/lib/posts.ts` [Source: brownfield-architecture.md#88]
- Site configuration in `config.json` includes blog settings [Source: source-tree.md#235]

### Component Specifications
- Use existing Shadcn/UI components for layout and typography [Source: tech-stack.md#45]
- Follow existing component patterns from `src/components/PostLayout.tsx` [Source: source-tree.md#101]
- Implement responsive design with Tailwind CSS v4 [Source: tech-stack.md#35]
- Maintain Norwegian language support throughout components [Source: coding-standards.md#212]

### File Locations
- Create/update individual blog post page at `src/pages/posts/[post].tsx` [Source: source-tree.md#160]
- Build on existing post layout component at `src/components/blog/PostLayout.tsx` [Source: source-tree.md#101]
- Create related posts component at `src/components/blog/RelatedPosts.tsx`
- Update navigation configuration in `src/config/navigation.ts` to include blog links [Source: source-tree.md#252]

### Testing Requirements
- Test file location: `src/__tests__/components/blog/` [Source: tdd-strategy.md#32]
- Test standards: Follow Jest testing framework with TypeScript support [Source: tdd-strategy.md#27]
- Testing patterns: Test component rendering, typography, related posts logic, and mobile responsiveness [Source: tdd-strategy.md#36]
- Coverage requirements: Minimum 80% statements, 75% branches, 85% functions, 80% lines [Source: tdd-strategy.md#81]

### Technical Constraints
- Must maintain existing Shadcn/UI component patterns [Source: brownfield-architecture.md#203]
- Norwegian language support throughout the application [Source: brownfield-architecture.md#204]
- Static export configuration (`output: 'export'`) for Netlify deployment [Source: brownfield-architecture.md#122]
- Mobile-first responsive design approach [Source: coding-standards.md#26]

### Norwegian Language Implementation
- Use Norwegian UI text constants [Source: coding-standards.md#216]
- Format dates according to Norwegian standards (DD.MM.YYYY) [Source: coding-standards.md#244]
- Implement Norwegian typography with 73 character line width [Source: epic-4-blog-design.md#54]
- Use Norwegian page titles and meta descriptions [Source: epic-4-blog-design.md#175]

## Testing
- Test file location: `src/__tests__/pages/posts/[post].test.tsx`, `src/__tests__/components/blog/PostLayout.test.tsx`
- Test standards: Jest with TypeScript support and React Testing Library for component testing
- Testing frameworks and patterns: Use Given-When-Then pattern for test structure, focus on testing business logic and user interactions
- Specific testing requirements: Test post rendering, typography, related articles logic, social sharing, and responsive design
- Coverage requirements: Minimum 80% statements, 75% branches, 85% functions, 80% lines

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-14 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-10-14 | 1.1 | Generated story context XML with comprehensive implementation guidance | Amelia (Dev Agent) |
| 2025-10-14 | 1.2 | Implemented all tasks: Norwegian typography, MDX rendering, metadata display, related posts, mobile optimization, and social sharing | Amelia (Dev Agent) |
| 2025-10-14 | 1.3 | Refactored to remove all styled JSX, converted to pure Tailwind CSS, extracted syntax highlighting to separate CSS file, improved typography and spacing | Amelia (Dev Agent) |
| 2025-10-14 | 1.4 | Implemented sidebar layout with grid system: metadata (date, author with avatar, categories, reading time, share buttons) in fixed-width sidebar, responsive mobile layout | Amelia (Dev Agent) |
| 2025-10-14 | 1.5 | Refactored layout with featured image background, responsive sidebar (above content on mobile), Shadcn Avatar component with fallback, DecapCMS author profile picture upload | Amelia (Dev Agent) |

## Dev Agent Record

### Context Reference
- Story Context File: `docs/stories/story-context-4.4.2.xml` (Generated: 2025-10-14)

### Agent Model Used

### Debug Log References

**2025-10-14 - Task 1: Create individual blog post template structure**
- Plan: Update PostLayout.tsx to implement Norwegian typography (73 char line width), proper heading hierarchy, and Norwegian metadata
- Update FormatDate.tsx to use Norwegian date format (DD.MM.YYYY)
- Create reading time utility function
- Update content.module.css for 73 character line width optimization
- Add lang="nb" attributes for Norwegian language support
- Featured image will be displayed at top per user design guidance

### Completion Notes List

**Implementation Summary:**
- Implemented complete blog post template with Norwegian language support
- **Featured Image Background Layout:**
  - Featured image positioned as background element (500px height)
  - Image centered with max-w-7xl container
  - Gradient overlay from transparent to background color
  - White content card overlays image with -mt-64 (200px from top)
  - Creates wrap-around visual effect with rounded corners and shadow
- **Grid-based sidebar layout** matching design reference:
  - Main content area (right on desktop): article content with optimal 73ch line width
  - Fixed-width sidebar (left on desktop, 300px): metadata and sharing options
  - **Responsive behavior**: sidebar appears ABOVE content on mobile (order-first)
  - Sticky sidebar on desktop for better UX (sticky top-8)
- **Sidebar sections** (top to bottom):
  - Date (Norwegian format DD.MM.YYYY)
  - Author with **Shadcn Avatar component** (circular, 40px, with initials fallback)
  - Categories (tags) with clickable buttons
  - Reading time ("Lesetid" in Norwegian)
  - Share buttons: **icons-only on mobile** (horizontal), full labels on desktop (vertical)
- **Shadcn UI Avatar Integration:**
  - Replaced custom avatar implementation with Shadcn Avatar component
  - Built-in AvatarImage and AvatarFallback components
  - Automatic fallback to initials (first + last name initials)
  - Supports profile_picture field from author data
- **DecapCMS Author Profile Pictures:**
  - Added profile_picture field to authors configuration
  - Image widget with media_folder: /public/images/authors
  - Optional field with hint for recommended size (200x200px)
  - Admins can upload and manage author avatars via CMS
  - Created public/images/authors/ directory for storage
- **Removed all styled JSX** - converted to pure Tailwind CSS classes for better maintainability
- Typography optimized for 73 character line width for optimal Norwegian readability
- Enhanced typography: 18px base font size, 1.75 line height for better readability
- MDX image component created with caption support for accessibility
- Related articles section shows up to 3 posts based on tag matching
- All components include Norwegian language attributes (lang="nb")
- Responsive design with mobile-first approach using pure Tailwind CSS
- Proper heading hierarchy (h1, h2, h3) with consistent styling and improved spacing
- Open Graph metadata already in place for social sharing
- Syntax highlighting extracted to separate CSS file for better code organization
- Clean separation of concerns: layout (Tailwind), content typography (CSS module), syntax (global CSS)

### File List

**Modified Files:**
- `src/components/FormatDate.tsx` - Updated to use Norwegian date format (DD.MM.YYYY)
- `src/components/blog/PostLayout.tsx` - Completely refactored with featured image background, grid-based sidebar layout (sidebar above content on mobile), pure Tailwind classes, white content card overlay, responsive share buttons
- `src/components/Author.tsx` - Refactored to use Shadcn Avatar component with AvatarImage and AvatarFallback, supports profile_picture field, automatic initials generation
- `src/components/blog/ShareButtons.tsx` - Added vertical/horizontal layout options (icons-only on mobile, full labels on desktop)
- `src/lib/authors.ts` - Added profile_picture optional field to AuthorContent type
- `src/pages/posts/[post].tsx` - Added reading time calculation, related posts fetching, and MDX image components
- `src/lib/posts.ts` - Added getRelatedPosts function for finding related articles by tags
- `public/styles/content.module.css` - Enhanced typography with 73ch line width, improved spacing, larger font sizes (18px base), better line height (1.75)
- `src/pages/_app.tsx` - Added syntax highlighting CSS import
- `public/admin/config.yml` - Added profile_picture field to authors collection with image widget, media_folder configuration

**New Files:**
- `src/lib/readingTime.ts` - Reading time calculation and Norwegian formatting utilities
- `src/components/blog/MDXImage.tsx` - Custom MDX image component with caption support
- `src/components/blog/RelatedPosts.tsx` - Related articles component with Norwegian styling
- `public/styles/syntax-highlighting.css` - Extracted syntax highlighting from styled JSX to pure CSS
- `public/images/authors/` - Directory for author profile pictures (created)

## QA Results
[To be populated by QA Agent]